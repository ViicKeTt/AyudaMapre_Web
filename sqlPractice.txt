/****** Script for SelectTopNRows command from SSMS  ******/
--SELECT TOP (1000) [Id]
--      ,[PacientId]
--      ,[BeneficiaryId]
--      ,[Relationship]
--      ,[MedicalCenter]
--      ,[TreatingPhysician]
--      ,[InsuranceCompanyId]
--      ,[CarnetNumber]
--      ,[Date]
--      ,[State]
--  FROM [SistemaSaludDev].[dbo].[SubsidyPrescription] where Date like '%2023-06%'

  --select *
  --from [SubsidyPrescription] as sp
  --inner join SubsidyBalance as sb on sb.SubsidyPrescriptionId = sp.Id
  --where sp.Date like '2023-06-%' and sp.State in ('Entregado','Aceptada') and PacientId = 13908
  
  
  select SUM(sb.ConsumedByMapre) as 'Suma de Mapre'
  from [SubsidyPrescription] as sp
  inner join SubsidyBalance as sb on sb.SubsidyPrescriptionId = sp.Id
  where sp.Date like '2023-08-%' and sp.State in ('Entregado','Aceptada') and PacientId = 13908

--select * from pacients where Cedula= '00112943725'

  --2023-07-18 15:26:18.6537580     83 - 2000

  --2200 - 1100 = 1100


  --delete [SubsidyPrescription] where Id in (83,81,45, 40,62)


  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/****** Script for SelectTopNRows command from SSMS  ******/
SELECT TOP (1000) [Id]
      ,[TotalMedicaments]
      ,[TotalAmountAnnually]
      ,[TotalAmountMonthly]
      ,[ConsumedByArs]
      ,[ConsumedByMapre]
      ,[ConsumedByCollaborator]
      ,[Date]
      ,[SubsidyPrescriptionId]
  FROM [dbBaseDatos].[dbo].[SubsidyBalance]


  --select max(ConsumedByCollaborator) as Total FROM [dbBaseDatos].[dbo].[SubsidyBalance]
  --select count(ConsumedByCollaborator)  FROM [dbBaseDatos].[dbo].[SubsidyBalance]
  
  select * from [dbBaseDatos].[dbo].[Pacients] where Name LIKE '______r%' -- No cuenta los espacios
  select * from [dbBaseDatos].[dbo].[Pacients] where Name LIKE 'a%a' -- Empiece con a y termine con a
  select * from [dbBaseDatos].[dbo].[Pacients] where Name LIKE '[abc]%' order by Name -- Start with 'a' or 'b' or 'c'
  select * from [dbBaseDatos].[dbo].[Pacients] where Name LIKE '[a-c]%' -- Start with since 'a' untill 'c' (a-c)

  -- Negative Like
  select * from [dbBaseDatos].[dbo].[Pacients] where Name not LIKE '[a-m]%' 
  select * from [dbBaseDatos].[dbo].[Pacients] where Name  LIKE '[!a-m]%'

  -- Es lo mismo que usar 'OR' pero mas simplicado
  SELECT * FROM [dbBaseDatos].[dbo].[Pacients] WHERE Name IN ('FRANCISCO JOSE', 'Carlos Augusto', 'Jose Joaquin'); 

  -- BETWEEN => Entre ,  In es como un 'OR'  
  SELECT * FROM [dbBaseDatos].[dbo].[Pacients] WHERE Id BETWEEN 0 AND 2000 AND Name NOT IN ('FRANCISCO JOSE', 'Carlos Augusto', 'Jose Joaquin', 'Francis Zuleyka');

  --Condicionales dentro del Select
  select   
  p.[Id],
  p.[Name],
  [LastName],
  [cedula],
  ins.[Name] as Tipo_Paciente,
  CAST(CASE
			WHEN Gender = 'F'
				THEN 'Femenino'
			ELSE 'Masculino'
		END as varchar)
  [Gender]
  from Pacients 
  as p
  inner join Institutions as ins
  on p.PacientTypeId = ins.Id
    
     select   
  p.[Id],
  p.[Name],
  [LastName],
  [cedula],
  ins.[Name] as Tipo_Paciente,
   IIF(Gender = 'F', 'Femenino', 'Masculino') as Genero
  from Pacients 
  as p
  inner join Institutions as ins
  on p.PacientTypeId = ins.Id  order by Genero desc

  select COUNT(*) as Hombres from Pacients where Gender = 'M'
  select COUNT(*) as Mujeres from Pacients where Gender = 'F'
  select COUNT(*) as Otros from Pacients where Gender not in ('F','M' ) 
  select * from Pacients where Gender not in ('F','M' )
   
   -- INNER JOIN, LEFT JOIN, RIGHT JOIN, FULL OUTER JOIN OR FULL JOIN
   --Self Join => Una uni�n autom�tica es una uni�n normal, pero la tabla se une consigo misma.

   --Group by
   select count(Gender) as Generos, Gender from Pacients group  by Gender
  -- SELECT COUNT(CustomerID), Country
		--FROM Customers
		--GROUP BY Country
  -- ORDER BY COUNT(CustomerID) DESC;

   --Listado de cliente de hombre y mujeres (IIF)
   select count(Gender) as Generos, 
   IIF(Gender = 'F', 'Femenino', IIF(Gender = 'M', 'Masculino', 'Otro')) as Generos from Pacients group by Gender
   
   --Listado de cliente de hombre y mujeres (CASE )
   select count(Gender) as Generos,  
   CAST(
        CASE
			WHEN Gender = 'F' THEN 'Femenino'
			WHEN Gender = 'M' then 'Masculino'
			else 'Otro'
        END AS varchar)
   from Pacients group by Gender
    
	--'TRUNCATE TABLE' es m�s r�pido y elimina todos los datos de la tabla,
	--mientras que 'DELETE' es m�s flexible y se utiliza para eliminar filas
	--espec�ficas de una tabla. La elecci�n entre ellos depender� de tus necesidades 
	--y de si deseas eliminar todos los datos de la tabla o solo ciertas filas.

--   select [SubsidyBalance].ConsumedByMapre, SubsidyPrescription.PacientId,UPPER(CONCAT(Pacients.Name,' ', Pacients.LastName)) as PacientName,Pacients.Cedula, CONVERT(varchar,[SubsidyBalance].Date,3) as 'Date', State
-- 	  from [SubsidyBalance]
-- 	   RIGHT JOIN SubsidyPrescription ON 
-- 	 [SubsidyBalance].SubsidyPrescriptionId = SubsidyPrescription.Id 
-- 	   RIGHT JOIN Pacients on SubsidyPrescription.PacientId = Pacients.Id
-- 	 where
-- 	 --PacientId = 13908 and
-- 	 State in ('Entregado','Aceptada')
-- 	  order by  SubsidyPrescription.PacientId

